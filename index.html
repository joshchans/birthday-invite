<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Josh’s 21st — Hyper Karting Party @ Moore Park</title>
<meta name="description" content="Josh’s 21st! Hyper Karting party at Moore Park. Neon F1 vibes, speed, and good times. RSVP inside." />
<meta property="og:title" content="Josh’s 21st — Hyper Karting Party" />
<meta property="og:description" content="Josh’s 21st! Hyper Karting party at Moore Park. Neon F1 vibes, speed, and good times." />
<meta property="og:type" content="website" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

<script>
/* =====================  EDIT ME (easy variables)  ===================== */
window.INVITE_CONFIG = {
  eventName: "Josh’s 21st — Hyper Karting at Moore Park",
  eventDateDisplay: "TBC",
  eventTimeDisplay: "TBC",
  locationName: "Hyper Karting — The Entertainment Quarter",
  addressLine: "Level 5 Car Park, 207 Park Road S, Moore Park NSW 2021",
  googleMapsLink: "https://www.google.com/maps?q=Hyper+Karting+Moore+Park",
  hostName: "Josh",
  organiserEmail: "josh@joshchans.com",
  fromEmail: "noreply@joshchans.com",

  /* ======= Email API ======= */
  noreplyApiUrl: "https://v0ck80w0g0occ4w88cc888oc.joshchans.com/api/send-email",
  noreplyApiKey: "14024a85-775f-412f-8543-eaf0ed482d32",

  maxPartySize: 30
};
/* ===================================================================== */
</script>

<style>
:root{--bg:#0b0e14;--panel:#111425;--text:#e6f1ff;--muted:#9aa7b2;--neon1:#00ffd1;--neon2:#6a5bff;--accent:#ff2e88;--amber:#ffc247;--ring:0 0 1.5rem rgba(0,255,209,.35),0 0 3rem rgba(106,91,255,.25)}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;scroll-behavior:smooth}
a{color:var(--neon1)}
.container{width:min(1100px,92vw);margin-inline:auto}
.site-header{position:sticky;top:0;z-index:50;backdrop-filter:blur(8px);background:linear-gradient(180deg,rgba(11,14,20,.9),rgba(11,14,20,.4) 85%,transparent);display:flex;gap:24px;align-items:center;justify-content:space-between;padding:12px 18px;border-bottom:1px solid #151a2e}
.site-header nav a{margin:0 10px;text-decoration:none;color:#cfe9ff;opacity:.9}
.site-header nav a:hover{opacity:1;color:#fff}
.hero{position:relative;min-height:100svh;display:grid;place-items:center;overflow:hidden}
.hero-inner{position:relative;z-index:3;text-align:center;padding:60px 0 40px}
#track{position:absolute;inset:0;z-index:2;opacity:.9;pointer-events:none;display:block}
#sparks{position:fixed;inset:0;z-index:1;opacity:.45;pointer-events:none}
h1,h2{margin:0}
h1.big{font-family:Orbitron,Inter,sans-serif;font-size:clamp(2.4rem,7vw,5.6rem);letter-spacing:.05em;margin:6px 0 4px}
h2.hero-title{font-family:Orbitron,Inter,sans-serif;font-size:clamp(1.8rem,6vw,4.6rem);letter-spacing:.05em;margin:0 0 10px}
.subtitle{color:var(--muted);margin:0 0 24px}
.badges{display:flex;flex-wrap:wrap;gap:16px;justify-content:center;margin:24px 0}
.badge{display:flex;align-items:center;gap:10px;background:linear-gradient(135deg,#0e1324,#090d18);border:1px solid #1a2140;padding:10px 12px;border-radius:999px;box-shadow:var(--ring)}
.badge .icon{width:22px;height:22px;color:var(--neon1)}
.cta{display:inline-block;padding:14px 22px;border-radius:12px;background:linear-gradient(135deg,var(--neon1),var(--neon2));color:#02040a;text-decoration:none;font-weight:700;box-shadow:0 6px 28px rgba(0,255,209,.35);border:0}
.cta:hover{transform:translateY(-1px);filter:brightness(1.05)}
.scroll-indicator{margin-top:30px;font-size:.85rem;color:#a2b5c5;opacity:.8;animation:float 2s ease-in-out infinite}
@keyframes float{0%{transform:translateY(0)}50%{transform:translateY(-6px)}100%{transform:translateY(0)}}
.section-title{font-family:Orbitron,Inter,sans-serif;font-weight:700;letter-spacing:.06em;margin:0 0 16px}
.details{padding:64px 0;background:radial-gradient(60rem 40rem at -10% 0, rgba(255,46,136,.1), transparent)}
.details-cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:18px}
.card{background:linear-gradient(160deg,#0e1324 0,#0a0f1d 100%);border:1px solid #1a2140;border-radius:16px;padding:18px;box-shadow:var(--ring)}
.card h3{margin:6px 0 8px;font-family:Orbitron,Inter,sans-serif}
.clean{margin:0;padding-left:20px;color:#cfe9ff}
.mini-note{color:#9fb0c0;font-size:.85rem}
.track-facts{padding:68px 0}
.facts{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px}
.fact{display:flex;gap:12px;align-items:flex-start;background:#0b1020;border:1px solid #151a2e;padding:14px;border-radius:14px;transition:transform .25s ease}
.fact:hover{transform:translateY(-2px)}.fact svg{width:28px;height:28px;color:var(--neon2)}
.fact h4{margin:2px 0 4px}.fact p{margin:0;color:#b8c5d2}
.rsvp{padding:76px 0;background:radial-gradient(50rem 30rem at 120% 100%, rgba(0,255,209,.1), transparent)}
form{display:grid;gap:12px;max-width:560px;margin-inline:auto}
.form-row{display:grid;gap:6px}
input,textarea{background:#0c1120;color:#eaf2ff;border:1px solid #1b2442;border-radius:10px;padding:12px;outline:0}
input:focus,textarea:focus{border-color:var(--neon1);box-shadow:0 0 0 3px rgba(0,255,209,.15)}
#rsvpStatus{min-height:1.3em}
.faq{padding:64px 0}
details{background:#0b1020;border:1px solid #151a2e;padding:12px 14px;border-radius:12px;margin-bottom:10px}
/* ultra-soft tint, no hard edge */
.details{
  background:
    radial-gradient(80rem 45rem at -30% -20%,
      rgba(255,46,136,.06) 0,
      rgba(255,46,136,0) 60%) !important;
}
summary{cursor:pointer;font-weight:600}
.footer{padding:28px 0;border-top:1px solid #151a2e;color:#a8b9c9;text-align:center}
.footer .tiny{font-size:.8rem;color:#94a5b6}
/* Glitch/flicker/stutter */
.glitch{position:relative;display:inline-block}
.glitch::before,.glitch::after{content:attr(data-text);position:absolute;inset:0;mix-blend-mode:screen;animation:glitch 2.7s infinite linear alternate}
.glitch::before{transform:translate(2px,0);color:var(--neon1);filter:blur(.5px)}
.glitch::after{transform:translate(-2px,0);color:var(--neon2);filter:blur(.5px)}
@keyframes glitch{
  0%{clip-path:inset(0)}
  12%{clip-path:inset(18% 0 0 0)}
  28%{clip-path:inset(0 0 62% 0)}
  46%{clip-path:inset(0)}
  64%{clip-path:inset(40% 0 0 0)}
  82%{clip-path:inset(0 0 20% 0)}
  100%{clip-path:inset(0)}
}
.hero .grid{
  position:absolute;
  inset:-10%;
  z-index:2;            /* behind #track, which is later in DOM */
  transform:perspective(800px) rotateX(60deg) translateY(-20%);
}
.flicker{animation:flicker 3.5s infinite steps(70,end)}
@keyframes flicker{0%,3%,6%,7%,8%,100%{opacity:1;text-shadow:0 0 12px rgba(0,255,209,.25),0 0 28px rgba(106,91,255,.15)}2%,5%,7.5%{opacity:.65;text-shadow:0 0 6px rgba(0,255,209,.15)}4%{opacity:.35}}
.stutter{animation:stutter .38s steps(14,end)}
@media (prefers-reduced-motion: reduce){.glitch::before,.glitch::after,.flicker,.scroll-indicator{animation:none}}
/* honeypot */
.hpot{position:absolute;left:-9999px;width:1px;height:1px;overflow:hidden}

/* NEW: full-page neon grid background with soft fade (no hard edge) */
.neon-grid{
  position:fixed; inset:-20vh -20vw; z-index:1; pointer-events:none; opacity:.9;
  background:
    radial-gradient(60rem 40rem at 80% -10%, rgba(106,91,255,.35), transparent),
    radial-gradient(60rem 40rem at 20% 120%, rgba(0,255,209,.25), transparent),
    repeating-linear-gradient(to bottom, rgba(255,255,255,.06) 0 1px, transparent 1px 80px),
    repeating-linear-gradient(to right, rgba(255,255,255,.06) 0 1px, transparent 1px 80px);
  transform:perspective(800px) rotateX(60deg) translateY(-10%);
  -webkit-mask-image: radial-gradient(160% 140% at 50% 30%, rgba(0,0,0,1) 55%, rgba(0,0,0,0) 95%);
  mask-image: radial-gradient(160% 140% at 50% 30%, rgba(0,0,0,1) 55%, rgba(0,0,0,0) 95%);
}

/* Small-screen tweaks */
@media (max-width: 480px){
  .hero-inner{padding:44px 0 32px}
  .badges{gap:12px}
}
</style>
</head>
<body>
<canvas id="sparks" aria-hidden="true"></canvas>
<div class="neon-grid" aria-hidden="true"></div>

<header class="site-header">
  <div class="logo">
    <svg viewBox="0 0 220 40" role="img" aria-label="Hyper Karting Party">
      <defs><linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#00FFD1"/><stop offset="100%" stop-color="#6A5BFF"/></linearGradient></defs>
      <text x="0" y="28" font-family="Orbitron, sans-serif" font-size="28" fill="url(#grad)" letter-spacing="2">HYPER•INVITE</text>
    </svg>
  </div>
  <nav><a href="#details">Details</a><a href="#rsvp">RSVP</a><a href="#faq">FAQ</a></nav>
</header>

<section class="hero" id="top">
  <div class="grid" aria-hidden="true"></div>
  <canvas id="track" aria-hidden="true"></canvas>
  <div class="hero-inner">
    <h1 class="big flicker"><span class="glitch" data-text="Josh’s 21st">Josh’s 21st</span></h1>
    <h2 class="hero-title"><span class="glitch" data-text="Hyper Karting">Hyper Karting</span> <span class="glitch" data-text="Party">Party</span></h2>
    <p class="subtitle">Moore Park • Neon speed • Electric vibes</p>
    <div class="badges">
      <div class="badge"><svg viewBox="0 0 64 64" class="icon"><path d="M10,6 v52" stroke="currentColor" stroke-width="4" fill="none"/><path d="M14 10c9 0 12 6 21 6s12-6 21-6v20c-9 0-12 6-21 6s-12-6-21-6V10z" fill="currentColor" opacity=".25"/></svg><span>Retarts in Cars</span></div>
      <div class="badge"><svg viewBox="0 0 64 64" class="icon"><path d="M8 36c0-14 12-24 24-24s24 10 24 24H36L24 28H8" fill="currentColor"/><rect x="8" y="36" width="48" height="8" rx="4" fill="currentColor" opacity=".3"/></svg><span>Blind Drivers (asians)</span></div>
      <div class="badge"><svg viewBox="0 0 64 64" class="icon"><circle cx="32" cy="36" r="20" fill="none" stroke="currentColor" stroke-width="4"/><path d="M32 36 L50 22" stroke="currentColor" stroke-width="4" stroke-linecap="round"/></svg><span>DRS (Drunk Racing Scoreboard)</span></div>
    </div>
    <a class="cta" href="#rsvp">RSVP Now</a>
    <div class="scroll-indicator">Scroll</div>
  </div>
</section>

<section class="details" id="details">
  <div class="container">
    <h2 class="section-title">Event Details</h2>
    <div class="details-cards">
      <article class="card"><h3>When</h3><p><span id="dateDisplay">TBC</span> @ <span id="timeDisplay">TBC</span></p><div class="mini-note">Times subject to track availability.</div></article>
      <article class="card"><h3>Where</h3><p><strong id="locName">Hyper Karting — The Entertainment Quarter</strong><br><span id="addr">Level 5 Car Park, 207 Park Road S, Moore Park NSW 2021</span></p><p><a id="mapsLink" target="_blank" rel="noopener">Open in Google Maps →</a></p></article>
      <article class="card"><h3>Drip Check</h3><ul class="clean"><li>Closed-toe shoes</li><li>Long hair tied back</li><li>Helmets provided</li></ul><div class="mini-note">We’ll handle booking + sessions.</div></article>
    </div>
  </div>
</section>

<section class="track-facts">
  <div class="container">
    <h2 class="section-title">Track Energy</h2>
    <div class="facts">
      <div class="fact"><div class="fact-icon"><svg viewBox="0 0 64 64"><path d="M30 2 L10 38 h16 l-2 24 L54 24 H38 l2-22z" fill="currentColor"/></svg></div><div class="fact-text"><h4>Electric karts</h4><p>Quiet. Clean. Instant torque.</p></div></div>
      <div class="fact"><div class="fact-icon"><svg viewBox="0 0 64 64"><rect x="6" y="10" width="52" height="12" rx="6" fill="currentColor"/><rect x="6" y="30" width="52" height="12" rx="6" fill="currentColor"/></svg></div><div class="fact-text"><h4>Kart top speed</h4><p>20–40 km/h based on your first lap each session.</p></div></div>
      <div class="fact"><div class="fact-icon"><svg viewBox="0 0 64 64"><circle cx="32" cy="32" r="28" stroke="currentColor" stroke-width="4" fill="none"/><path d="M8 32h48" stroke="currentColor" stroke-width="4"/></svg></div><div class="fact-text"><h4>All-weather</h4><p>Covered venue. Rain or shine.</p></div></div>
    </div>
  </div>
</section>

<section class="rsvp" id="rsvp">
  <div class="container">
    <h2 class="section-title">RSVP</h2>
    <form id="rsvpForm" novalidate>
      <div class="form-row"><label for="name">Name</label><input id="name" name="name" type="text" required placeholder="Your full name" /></div>
      <div class="form-row"><label for="email">Email</label><input id="email" name="email" type="email" required placeholder="you@example.com" /></div>
      <div class="form-row"><label for="message">Message (optional)</label><textarea id="message" name="message" rows="3" placeholder="Dietary, accessibility, vibes…"></textarea></div>
      <button type="submit" class="cta">Send RSVP</button>
      <p id="rsvpStatus" role="status" aria-live="polite"></p>
    </form>
  </div>
</section>

<section class="faq" id="faq">
  <div class="container">
    <h2 class="section-title">FAQ</h2>
    <details><summary>Do I need a licence?</summary><p>No, clearly you don't otherwise I wouldnt have invited you.</p></details>
    <details><summary>What should I bring?</summary><p>Closed-toe shoes and your game face. Helmets provided.</p></details>
    <details><summary>Public transport?</summary><p>Obviously, you don't have a licence.</p></details>
    <details><summary>What if I crash?</summary><p>You're asian.</p></details>
    <details><summary>Who can come?</summary><p>Since you opened this question you're not invited anymore.</p></details>
    <details><summary>When is it?</summary><p>You're retarted. Or asian. Becuase you clearly didn't see right above.</p></details>
    <details><summary>Who else is coming?</summary><p>Well if that matters you're not a real one...</p></details>
        <details><summary>Can I wear a swimming costume?</summary><p>Only if I can see your bulge.</p></details>
    <details><summary>Will Mummy Chan be there?</summary><p>Wouldn't you like to know...</p></details>
    <details><summary>Is it your birthday?</summary><p>No.</p></details>
  </div>
</section>

<footer class="footer">
  <div class="container">
    <p>Hosted by <span id="hostName">Josh</span> • <a id="mailtoLink">Contact host</a></p>
    <p class="tiny">No terms or conditions apply. I wansn't bothered to make any.</p>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/ScrollTrigger.min.js"></script>
<script>
/* ========= Ambient neon particles ========= */
(function(){
  const canvas = document.getElementById('sparks');
  const ctx = canvas.getContext('2d');
  let particles = [];

  function resize(){
    const dpr = Math.min(2, window.devicePixelRatio||1);
    canvas.style.width  = window.innerWidth + 'px';
    canvas.style.height = window.innerHeight + 'px';
    canvas.width  = Math.floor(window.innerWidth  * dpr);
    canvas.height = Math.floor(window.innerHeight * dpr);
    ctx.setTransform(dpr,0,0,dpr,0,0);
  }
  addEventListener('resize', resize, {passive:true});
  resize();

  function spawn(n=4){
    for(let i=0;i<n;i++){
      const ttl = 80 + Math.random()*120;
      particles.push({
        x: Math.random()*window.innerWidth,
        y: Math.random()*window.innerHeight,
        vx: (Math.random()-.5)*.6,
        vy: (Math.random()-.5)*.6,
        life: ttl,
        ttl,
        seed: Math.random()*1000
      });
    }
  }

  (function tick(){
    ctx.clearRect(0,0,window.innerWidth,window.innerHeight);
    ctx.globalCompositeOperation = 'lighter';

    for(let i=0;i<particles.length;i++){
      const p = particles[i];
      p.x += p.vx; p.y += p.vy; p.life--;

      if(p.x<0||p.x>window.innerWidth)  p.vx *= -1;
      if(p.y<0||p.y>window.innerHeight) p.vy *= -1;

      const t = 1 - p.life/p.ttl;                 // 0 → 1 over lifetime
      const fadeIn  = Math.min(1, t/0.15);
      const fadeOut = Math.min(1, (p.life/p.ttl)/0.15);
      const flicker = 0.85 + 0.15*Math.sin((p.ttl - p.life + p.seed)*0.5);
      const alpha = Math.min(fadeIn, fadeOut) * flicker;

      const g = ctx.createRadialGradient(p.x,p.y,0,p.x,p.y,40);
      g.addColorStop(0, `rgba(0,255,209,${0.35*alpha})`);
      g.addColorStop(1, `rgba(106,91,255,0)`);
      ctx.fillStyle = g;
      ctx.beginPath();
      ctx.arc(p.x,p.y,40,0,Math.PI*2);
      ctx.fill();
    }

    particles = particles.filter(p => p.life > 0);
    if(particles.length < 120) spawn();
    requestAnimationFrame(tick);
  })();
})();

/* ========= Mini track animation (responsive, no cut-off) ========= */
(function(){
  const c = document.getElementById('track'); const ctx = c.getContext('2d');
  let W=0,H=0,cx=0,cy=0,rx=0,ry=0,dpr=1;
  const teams=[{color:'#00ffd1',trim:'#061a16'},{color:'#6a5bff',trim:'#0c1030'},{color:'#ff2e88',trim:'#2a0b1a'},{color:'#ffc247',trim:'#2a2108'}];
  const cars=Array.from({length:4},(_,i)=>({team:teams[i%4],t:Math.random()*Math.PI*2,v:0.009+Math.random()*0.004,lane:[-18,-6,6,18][i%4],flame:0}));

  function fit(){
    const r=document.querySelector('.hero').getBoundingClientRect();
    dpr = Math.min(2, window.devicePixelRatio||1);
    c.style.width = r.width + 'px';
    c.style.height = r.height + 'px';
    c.width  = Math.floor(r.width  * dpr);
    c.height = Math.floor(r.height * dpr);
    ctx.setTransform(dpr,0,0,dpr,0,0);
    W = r.width; H = r.height; cx=W/2; cy=H/2;
    const s = Math.min(W,H);
    rx = s*0.40;
    ry = s*0.28;
  }
  addEventListener('resize',fit,{passive:true}); fit();

  function drawTrack(){
    ctx.save(); ctx.translate(cx,cy);
    ctx.strokeStyle='#0e1324'; ctx.lineWidth=54; ctx.beginPath();
    for(let a=0;a<=Math.PI*2+0.01;a+=0.02){const x=rx*Math.cos(a),y=ry*Math.sin(a); if(a===0)ctx.moveTo(x,y); else ctx.lineTo(x,y)} ctx.stroke();
    ctx.strokeStyle='rgba(0,255,209,.18)'; ctx.lineWidth=58; ctx.stroke(); ctx.restore();

    ctx.save(); ctx.setLineDash([12,14]); ctx.lineDashOffset=-(Date.now()/60)%26; ctx.strokeStyle='rgba(255,255,255,.28)'; ctx.lineWidth=2; ctx.beginPath();
    for(let a=0;a<=Math.PI*2+0.01;a+=0.02){const x=cx+rx*Math.cos(a),y=cy+ry*Math.sin(a); if(a===0)ctx.moveTo(x,y); else ctx.lineTo(x,y)} ctx.stroke(); ctx.restore();

    const sfA=Math.PI*1.5, sx=cx+rx*Math.cos(sfA), sy=cy+ry*Math.sin(sfA);
    ctx.save(); ctx.translate(sx,sy); ctx.rotate(Math.atan2(ry*Math.cos(sfA),-rx*Math.sin(sfA)));
    for(let i=-3;i<4;i++){for(let j=0;j<4;j++){ctx.fillStyle=((i+j)&1)?'rgba(255,255,255,.9)':'#111'; ctx.fillRect(i*8-8,-26+j*8,8,8)}} ctx.restore();
  }

  function wheel(x,y,r,spin){ctx.save();ctx.translate(x,y);ctx.fillStyle='#0a0f1d';ctx.beginPath();ctx.arc(0,0,r,0,Math.PI*2);ctx.fill();
    ctx.strokeStyle='rgba(255,255,255,.25)';ctx.lineWidth=2;ctx.beginPath();ctx.arc(0,0,r-3,(Date.now()/150+spin)%6.28,(Date.now()/150+spin+1.6)%6.28);ctx.stroke();ctx.restore();}

  function carDraw(k){
    const a=k.t, tx=-rx*Math.sin(a), ty=ry*Math.cos(a), len=Math.hypot(tx,ty)||1, nx=-ty/len, ny=tx/len;
    const x=cx+rx*Math.cos(a)+nx*k.lane, y=cy+ry*Math.sin(a)+ny*k.lane, ang=Math.atan2(ty,tx);
    ctx.save(); ctx.translate(x,y); ctx.rotate(ang);
    wheel(-28,-12,8,0.2); wheel(-28,12,8,0.6); wheel(22,-12,8,0.9); wheel(22,12,8,1.3);
    ctx.fillStyle=k.team.color; ctx.strokeStyle=k.team.trim; ctx.lineWidth=2; ctx.beginPath();
    ctx.moveTo(-26,-10); ctx.quadraticCurveTo(-16,-18,6,-14); ctx.lineTo(28,-10); ctx.lineTo(28,10); ctx.lineTo(6,14); ctx.quadraticCurveTo(-16,18,-26,10); ctx.closePath(); ctx.fill(); ctx.stroke();
    ctx.fillStyle='#111927'; ctx.fillRect(-2,-10,20,20); ctx.strokeStyle='rgba(255,255,255,.25)'; ctx.lineWidth=3; ctx.beginPath(); ctx.arc(6,0,10,-1.1,1.1); ctx.stroke();
    ctx.fillStyle=k.team.color; ctx.beginPath(); ctx.moveTo(30,-8); ctx.lineTo(44,0); ctx.lineTo(30,8); ctx.closePath(); ctx.fill();
    ctx.fillStyle=k.team.trim; ctx.fillRect(34,-14,16,6); ctx.fillRect(34,8,16,6);
    ctx.fillStyle=k.team.trim; ctx.fillRect(-44,-16,12,32);
    const drs=(Math.abs(a%Math.PI)<.22); ctx.fillStyle=drs?'rgba(255,255,255,.75)':k.team.color; ctx.fillRect(-46,-14,22,10); if(!drs)ctx.fillRect(-46,4,22,10);
    if(Math.random()<0.3)k.flame=3; if(k.flame>0){ctx.globalCompositeOperation='lighter'; const grad=ctx.createLinearGradient(-46,0,-62,0); grad.addColorStop(0,'rgba(255,180,80,.9)'); grad.addColorStop(1,'rgba(255,60,140,0)'); ctx.fillStyle=grad; ctx.beginPath(); ctx.moveTo(-44,-4); ctx.lineTo(-62,0); ctx.lineTo(-44,4); ctx.closePath(); ctx.fill(); ctx.globalCompositeOperation='source-over'; k.flame--; }
    ctx.restore();
  }

  (function tick(){
    ctx.clearRect(0,0,W,H); drawTrack();
    cars.forEach(k=>{carDraw(k); k.t=(k.t+k.v)%(Math.PI*2)});
    const i=(Math.random()*cars.length)|0; cars[i].v+= (Math.random()-.5)*0.0006; cars[i].v=Math.min(0.014,Math.max(0.008,cars[i].v));
    requestAnimationFrame(tick);
  })();
})();

/* ========= Populate + EMAIL SEND ========= */
(function(){
  const cfg = window.INVITE_CONFIG||{}; const qs=s=>document.querySelector(s);

  // Inject details
  qs('#dateDisplay').textContent = cfg.eventDateDisplay||'TBC';
  qs('#timeDisplay').textContent = cfg.eventTimeDisplay||'TBC';
  qs('#locName').textContent = cfg.locationName||'Hyper Karting — Moore Park';
  qs('#addr').textContent = cfg.addressLine||'';
  const mapsLink = qs('#mapsLink'); if (mapsLink) mapsLink.href = cfg.googleMapsLink||'#';
  qs('#hostName').textContent = cfg.hostName||'Host';
  qs('#mailtoLink').setAttribute('href','mailto:'+encodeURIComponent(cfg.organiserEmail||'host@example.com')+'?subject='+encodeURIComponent('Josh’s 21st — Hyper Karting RSVP'));

  // ======== Email API helpers ========
  function emailShell(title, innerHtml){
    // static "glitch" header (email-safe layering)
    const glitchHeader = `
      <div style="position:relative;display:inline-block;font-family:Orbitron,Arial,Helvetica,sans-serif;font-size:22px;letter-spacing:.06em;line-height:1.2">
        <span style="position:absolute;left:1px;top:0;color:#00ffd1;opacity:.7">${title}</span>
        <span style="position:absolute;left:-1px;top:0;color:#6a5bff;opacity:.6">${title}</span>
        <span style="position:relative;color:#e6f1ff">${title}</span>
      </div>`.trim();

    return `
    <div style="background:#0b0e14;color:#e6f1ff;font-family:Inter,Segoe UI,Roboto,Arial,sans-serif;padding:24px">
      <div style="max-width:680px;margin:0 auto;background:linear-gradient(160deg,#0e1324,#090d18);border:1px solid #1a2140;border-radius:16px;overflow:hidden">
        <div style="padding:24px 22px;border-bottom:1px solid #151a2e;background:
                    radial-gradient(800px 400px at 90% -10%, rgba(106,91,255,.25), transparent),
                    radial-gradient(800px 400px at 10% 120%, rgba(0,255,209,.18), transparent)">
          ${glitchHeader}
        </div>
        <div style="padding:20px">${innerHtml}
          <p style="color:#9aa7b2;font-size:12px;margin-top:18px">This mailbox isn’t monitored. Replies go to the organiser.</p>
        </div>
      </div>
    </div>`.trim();
  }
  function detailsTable(e){
    return `
    <table role="presentation" cellpadding="0" cellspacing="0" style="width:100%;max-width:560px;margin:16px auto;border-collapse:collapse">
      <tr><td style="padding:8px 0"><strong>Date</strong></td><td style="padding:8px 0;text-align:right">${e.date||'TBC'}</td></tr>
      <tr><td style="padding:8px 0"><strong>Time</strong></td><td style="padding:8px 0;text-align:right">${e.time||'TBC'}</td></tr>
      <tr><td style="padding:8px 0"><strong>Where</strong></td><td style="padding:8px 0;text-align:right">${e.locationName||''}</td></tr>
      <tr><td style="padding:8px 0"><strong>Address</strong></td><td style="padding:8px 0;text-align:right">${e.address||''}</td></tr>
    </table>`.trim();
  }

  async function sendEmail(payload){
    const url = cfg.noreplyApiUrl;
    const key = cfg.noreplyApiKey;
    if(!url || !key) throw new Error('Email API not configured');
    const res = await fetch(url,{
      method:'POST',
      headers:{'Content-Type':'application/json','x-api-key':key},
      body: JSON.stringify(payload)
    });
    if(!res.ok){ const t=await res.text().catch(()=> ''); throw new Error('Email API error: '+t); }
    return res.json();
  }

  // ======== RSVP handler (1 person only) ========
  const form=document.getElementById('rsvpForm'), status=document.getElementById('rsvpStatus');
  const emailRx = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

  form?.addEventListener('submit', async (e)=>{
    e.preventDefault(); status.textContent='Sending…';
    const b=Object.fromEntries(new FormData(form).entries());
    if(b.website){ status.textContent='Thanks!'; form.reset(); return; } // honeypot
    const name=(b.name||'').trim(), email=(b.email||'').trim();
    const message=(b.message||'').trim();

    if(!name || !email){ status.textContent='Add your name + email.'; return; }
    if(!emailRx.test(email)){ status.textContent='Please check that the email is correct and is valid'; return; }

    const event = {title:cfg.eventName, date:cfg.eventDateDisplay, time:cfg.eventTimeDisplay, locationName:cfg.locationName, address:cfg.addressLine};
    const first = name.split(' ')[0];

    // Attendee (no “we’ll confirm times” line)
    const attendeeHTML = emailShell('RSVP confirmation',
      `<p>Hi ${first},</p>
       <p>Locked in! Thanks for RSVPing to <strong>${event.title}</strong>.</p>
       ${detailsTable(event)}
       ${message? `<p><strong>Your note:</strong><br>${escapeHtml(message)}</p>`:''}`
    );

    // Organiser: trimmed fields + new sender name
    const organiserHTML = emailShell('New RSVP received',
      `<p><strong>Name:</strong> ${escapeHtml(name)}<br/>
         <strong>Email:</strong> ${escapeHtml(email)}</p>
       ${message? `<p><strong>Message:</strong><br>${escapeHtml(message)}</p>`:''}`
    );

    try{
      await sendEmail({
        to: email,
        subject: `RSVP confirmed — ${event.title}`,
        html: attendeeHTML,
        text: `Hi ${first}, you’re in for ${event.title}. Date: ${event.date} Time: ${event.time} Where: ${event.locationName} — ${event.address}.${message? ` Note: ${message}`:''}`,
        fromName: "Josh’s 21st RSVP",
        replyTo: cfg.organiserEmail
      });
      await sendEmail({
        to: cfg.organiserEmail,
        subject: `New RSVP — ${name}`,
        html: organiserHTML,
        text: `Name: ${name}\nEmail: ${email}\n${message? `Message: ${message}\n`:''}`,
        fromName: "Josh’s 21st RSVP System",
        replyTo: email
      });
      status.textContent='RSVP received! Check your email for confirmation.'; form.reset();
    }catch(err){
      console.error(err);
      status.textContent='Please check that the email is correct and is valid';
    }
  });

  function escapeHtml(s){return String(s).replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]))}
})();
</script>
</body>
</html>
